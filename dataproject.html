---
layout: infographic
---
<script src="https://d3js.org/d3.v4.min.js"></script>
<!-- <a href="/img/nathan-draft-1.png">draft 1</a> -->

<div class="container">

<section id="mainTitle">
  <div class="centeredText">
    <h1>Why do we sleep alone?</h1>
    <p>Using research conducted by FiveThirtyEight, we dive deeper into the causes and effects of sleeping seperately from one's significant other.</p>
  </div>
</section>

<section id="pieChartSection">
  <div class="toolTip" style="opacity: 0;"></div>

  <svg id="pieChartSVG" class= width=100% height=600>

    <g id="bracket-left" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(330, 95)">
      <path d="M62.701049,0 C62.701049,0 -20.8946724,24.433608 5.2790672,111.464549 C31.4528068,198.49549 -4.61852778e-14,198.595495 -4.61852778e-14,198.595495" id="Path-2" stroke="#4A4A4A" stroke-width="2"></path>
      <path d="M62.701049,397.845495 C62.701049,397.845495 -20.8946724,373.411887 5.2790672,286.380946 C31.4528068,199.350005 2.73558953e-13,199.25 2.73558953e-13,199.25" id="Path-2" stroke="#4A4A4A" stroke-width="2"></path>
    </g>
    <text x="160" y="300" font-family="American Typewriter" font-size="20px" fill="black">Sleeps alone</text>

    <g id="bracket-right" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(837.39378, 291.25) rotate(-180.000000) translate(-797.393780, -261.250000) translate(765.893780, 62.250000)">
      <path d="M62.701049,0 C62.701049,0 -20.8946724,24.433608 5.2790672,111.464549 C31.4528068,198.49549 -4.61852778e-14,198.595495 -4.61852778e-14,198.595495" id="Path-2" stroke="#4A4A4A" stroke-width="2"></path>
      <path d="M62.701049,397.845495 C62.701049,397.845495 -20.8946724,373.411887 5.2790672,286.380946 C31.4528068,199.350005 2.73558953e-13,199.25 2.73558953e-13,199.25" id="Path-2" stroke="#4A4A4A" stroke-width="2"></path>
    </g>
    <text x="915" y="300" font-family="American Typewriter" font-size="20px" fill="black">Never sleeps alone</text>
  </svg>
</section>


<section id="dotChartSection">
  <div class="text-container">
    <h2 id="dotChartTitle">When do people sleep alone, does it improve their sex life?</h2>
    <p id="dotChartP" class="small-p">The data shows that those in early relationships (1-5 years) and those who have been together for 20 years or more are the most likely to have their relationship or sex life improve from sleeping seperately.</p>
    <button class="dotChartBtn noSelect" id="sexBtn">Sex Life</button>
    <button class="dotChartBtn noSelect" id="relationshipBtn">Relationship</button>
  </div>
  <svg id="dotChartSVG" class="">
    <!-- Y axis -->
    <line x1="250" y1="700" x2="1500" y2="700" stroke-width="4" stroke="black"></line>
    <text text-anchor="end" x="220" y="200" font-family="American Typewriter" font-size="16px" fill="black">Strongly agree</text>
    <text text-anchor="end" x="220" y="300" font-family="American Typewriter" font-size="16px" fill="black">Somewhat disagree</text>
    <text text-anchor="end" x="220" y="400" font-family="American Typewriter" font-size="16px" fill="black">Neither agree nor disagree</text>
    <text text-anchor="end" x="220" y="500" font-family="American Typewriter" font-size="16px" fill="black">Somewhat disagree</text>
    <text text-anchor="end" x="220" y="600" font-family="American Typewriter" font-size="16px" fill="black">Strongly disagree</text>
    <!-- X axis -->
    <line x1="250" y1="100" x2="250" y2="700" stroke-width="4" stroke="black"></line>
    <text text-anchor="middle" x="350" y="750" font-family="American Typewriter" font-size="16px" fill="black">Immediately</text>
    <text text-anchor="middle" x="550" y="750" font-family="American Typewriter" font-size="16px" fill="black">1-5 years</text>
    <text text-anchor="middle" x="750" y="750" font-family="American Typewriter" font-size="16px" fill="black">6-10 years</text>
    <text text-anchor="middle" x="950" y="750" font-family="American Typewriter" font-size="16px" fill="black">11-15 years</text>
    <text text-anchor="middle" x="1150" y="750" font-family="American Typewriter" font-size="16px" fill="black">16-20 years</text>
    <text text-anchor="middle" x="1350" y="750" font-family="American Typewriter" font-size="16px" fill="black">>20 years</text>

  </svg>
</section>
<!--
<section id="circleChartSection">
  <h2 id="dotChartTitle">When do people start sleeping alone, does it improve sex life?</h2>
  <p id="dotChartP" class="small-p">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque euismod facilisis augue ac varius. Nulla vitae ligula augue. Nam cursus mattis ante vitae tempor. Donec nec eleifend urna. Suspendisse faucibus faucibus rutrum. Etiam ultricies enim quis faucibus tristique.</p>
  <div class="circleChartBtnGroup">
    <button class="circleChartBtn" id="">Immediately</button>
    <button class="circleChartBtn" id="">1-5</button>
    <button class="circleChartBtn" id="">6-10</button>
    <button class="circleChartBtn" id="">11-15</button>
    <button class="circleChartBtn" id="">16-20</button>
    <button class="circleChartBtn" id="">>20</button>
  </div>
  <svg id="circleChartSVG" class="" width=100% height=600></svg>
</section> -->



</div>




<script>

//rStatus
//rLength
//separateBeds
//sleepLocation
//sleepLocationOther
//sleepLocationPartner
//sleepLocationPartnerOther
//separateReason0
//separateReason1
//separateReason2
//separateReason3
//separateReason4
//separateReason5
//separateReason6
//separateReason7
//separateReason8
//separateReason9
//firstSeparateBed
//stayingTogether
//sleepBetterSeperate
//sexImproved
//occupation
//occupationOther
//gender
//age
//income
//education
//location


window.onload = function() {
  function createText() {
      var h = document.createElement("H1");
      var t = document.createTextNode("Hello World");
      h.appendChild(t);
      document.body.appendChild(h);
  }
};



d3.csv("data/sleeping-alone-data.csv", function(error, data){
  //console.log(error, file);
                          // data, index
  data = data.filter(function(d, i) {
    return i != 0; // D3 automatically makes the 1st row in a CSV file the headers, so when you call the first row it is technically the second row in the data set. in the case of java that means to call the "first row" i would actually call 0
  });
  data.forEach(function(d,i){
    d.id = i;
  });

  console.log(" ");
  console.log("-----------------------------------------------------------------------------");
  console.log("How often people sleep separately");
  console.log("-----------------------------------------------------------------------------");

  // Returns information about how often people sleep separately
  var separateBedData = d3.nest()
    .key(function(d, i, key){
      return d.separateBeds;
    })
    .entries(data);

  separateBedData = separateBedData.filter(function(d, i){
    return d.key != ""; // dont return people who didn't answer the question
  });

  separateBedData.forEach(function(d, i) {
    var amount = d.values.length;
  //  console.log(separateBedData[i].key + " " + amount);
  });

  var arc = d3.arc()
      .outerRadius(200 - 10)
      .innerRadius(0);

  var pieData = d3.pie().value(function(d){
    return d.values.length
  })(separateBedData);

  var color = d3.scaleOrdinal()
    .range(["#6BA4E7", "#8CB8ED", "lightgray", "#ADCDF2", "#DEEBFA", "#4A90E2", "#4A90E2"]);

  var pieGroup = d3.select("#pieChartSVG")
    .append("g")
    .attr("transform", "translate(" + 600 + "," + 600 / 2 + ")");

  var pieSlices = pieGroup.selectAll("path").data(pieData);

  var div = d3.select("#pieChartSection").append("div")
  .attr("class", "toolTip")
  .style("opacity", 0);

  pieSlices.enter().append("path")
    .attr("d", arc)
    .style("fill", function(d, i) {
      return color(d.data.key);
    })
    .on("mousemove", function(d) {
      var position = d3.mouse(d3.select("body").node());
          div.transition()
              .duration(200)
              .style("opacity", .9);
        	div.html(d.data.key + " " + "<b>" + d.data.values.length + "</b>" )
              .style("left", (position[0]) + 8 + "px")
              .style("top", (position[1] - 34) + "px");
        })
    .on("mouseout", function(d) {
          div.transition()
              .duration(500)
              .style("opacity", 0);
        });



  console.log(" ");
  console.log("-----------------------------------------------------------------------------");
  console.log("When people started to sleep alone");
  console.log("-----------------------------------------------------------------------------");

  // Returns information about when people started to sleep separately, grouped by Gender
  var firstSeparateBedData = d3.nest()
    .key(function(d, i, key){
      return d.gender + " " + d.firstSeparateBed })
    .entries(data);

  firstSeparateBedData = firstSeparateBedData.filter(function(d, i){
    return d.key != ""; // dont return people who didn't include a gender
  });

  firstSeparateBedData.forEach(function(d,i){
    var x = firstSeparateBedData[i].values.length;
    //console.log(firstSeparateBedData[i].key + " " + x);
    // console.log(x);
  });



var dotChartData = data.filter(function(d, i){
  return d.separateBeds != "Never"
});
  console.log(dotChartData);


var margin = {top: 100, right: 100, bottom: 100, left: 250},
    DotChartWidth = 1500 - margin.left - margin.right,
    DotChartHeight = 1500 - margin.top - margin.bottom;

// add the graph canvas to the body of the webpage
var dotChartSVG = d3.select("#dotChartSVG")
    .attr("width", DotChartWidth + margin.left + margin.right)
    .attr("height", DotChartHeight + margin.top + margin.bottom)
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var yScale = d3.scaleOrdinal()
  .domain(["Strongly disagree", "Somewhat disagree", "Neither agree nor disagree", "Somewhat agree", "Strongly agree"])
  .range([100, 200, 300, 400, 500]);

var xScale = d3.scaleOrdinal()
  .domain(["Immediately/ We've always slept in separate beds", "Within the first 1-5 years of our relationship", "Within 6-10 years of our relationship", "Within 11-15 years of our relationship", "Within 16-20 years of our relationship", "After 20 years of our relationship"])
  .range([100, 300, 500, 700, 900, 1100]);

  var radius = 4;

  function dotChartFunction(key){

    var pack = d3.pack()
      .size([200, 100])
      .radius(function(){ return radius; })
      .padding(1);

    var groupedData = d3.nest()
      .key(function(d) {
        return d[key] + d.firstSeparateBed;
      })
      .entries(dotChartData.filter(function(d){
        return d[key].length;
      }));

    var packedData = [];
    groupedData.forEach(function(d) {

      // nests the data for the pack layout
      var root = d3.hierarchy(d, function(l) { return l.values; })
        .sum(function(l) { return 1; });

      packedData = packedData.concat(pack(root).children);

    });

    var circles = dotChartSVG.selectAll("circle")
                  .data(packedData, function(d){
                    return d.data.id;
                  });

      function circlePosition(circle) {
        circle
          .attr("cy", function(d){
            return yScale(d.data[key]) + d.y - 50;
          })
          .attr("cx", function(d){
            return xScale(d.data.firstSeparateBed) + d.x - 100;
          });
      }

    // enter animation for the first time this function is run
    var enter = circles.enter().append("circle")
                  .call(circlePosition)
                  .attr("r", 0)
                  .transition().duration(1000)
                  .attr("r", radius)
                  .attr("fill", function(d){
                    if (d.data.gender == "Male"){
                      return "#4A90E2";
                    }
                    else{
                      return "#50E3C2";
                    }
                  });

    // update the x and y coordinates when running this function after the first time
    circles
      .transition().duration(1000)
      .call(circlePosition);

    circles.merge(enter)
    .on("mousemove", function(d) {
      var total = d.parent.children.filter(function(i){
        return i.data.gender == d.data.gender;
      }).length;
      var position = d3.mouse(d3.select("body").node());
          div.transition()
              .duration(200)
              .style("opacity", .9);
            div.html(d.data.gender + " " + total)
              .style("left", (position[0]) + "px")
              .style("top", (position[1] - 28) + "px");
          })
    .on("mouseout", function(d) {
        div.transition()
            .duration(500)
            .style("opacity", 0);
          });

    circles.exit()
      .transition().duration(1000)
      .attr("r", 0)
      .remove();
  } // end dotChartFunction

// simply pass the key to be used to the function as a string
d3.select('#sexBtn').classed("active", true)
.on('click', function(d, i) {
  d3.select(this).classed("active", true);
  d3.select('#relationshipBtn').classed("active", false);
  dotChartFunction("sexImproved");
  d3.select('#dotChartTitle').text("When do people sleep alone, does it improve their sex life?");
  });

d3.select('#relationshipBtn')
.on('click', function(d, i) {
  d3.select(this).classed("active", true);
  d3.select('#sexBtn').classed("active", false);
  dotChartFunction("stayingTogether");
  d3.select('#dotChartTitle').text("When do people sleep alone, does it improve their relationship?");
});

dotChartFunction("sexImproved");





  console.log(" ");
  console.log("-----------------------------------------------------------------------------");
  console.log("Relationship improved");
  console.log("-----------------------------------------------------------------------------");

  var relationshipImprove = d3.nest()
        .key(function(d, i, key){
          return d.gender + " " + d.firstSeparateBed + " " + d.stayingTogether })
          .entries(data);

  relationshipImprove.forEach(function(d,i){
    var x = relationshipImprove[i].values.length;
    console.log(relationshipImprove[i].key + " " + x);
    // console.log(x);
  });


  console.log(" ");
  console.log("-----------------------------------------------------------------------------");
  console.log("Sex life improved");
  console.log("-----------------------------------------------------------------------------");


  var sexImproved = d3.nest()
        .key(function(d, i, key){
          return d.gender + " " + d.firstSeparateBed + " " + d.sexImproved })
          .entries(data);

  sexImproved.forEach(function(d,i){
    var x = sexImproved[i].values.length;
  //  console.log(sexImproved[i].key + " " + x);
    // console.log(x);
  });

//   var relationshipImprove = d3.nest()
//         .key(function(d, i, key){
//           return d.gender + " " + d.firstSeperateBed })
//         .key(function(d, i){
//           return d.stayingTogether
//         })
//         .key(function(d, i){
//           return d.sexImproved
//         })
//           .entries(data);
//
//   relationshipImprove.forEach(function(d,i){
//     var x = relationshipImprove[i].values.length;
//     // console.log(relationshipImprove[i].key + " " + x);
//     // console.log(x);
//   });
//
// console.log(relationshipImprove);

console.log(" ");
console.log("-----------------------------------------------------------------------------");
console.log("Reasons for sleeping separately");
console.log("-----------------------------------------------------------------------------");



var reasons = d3.nest()
      .key(function(d, i){
        return d.gender})
      .entries(data);

var reasonsMale = reasons[0].values;
var reasonsFemale = reasons[1].values;

var malesWhoAnswered1 = reasonsMale.filter(function(maleObject) {
  return !maleObject.separateReason0 === '';
});
var numMalesWhoAnswered0 = malesWhoAnswered1.length;



// generate a key for each "separate reason"
function generateKeys(string, count) {
  var result = [];
  for (i = 0; i < count; i++) {
    result[i] = string + i;
  }
  return result;
}

var reasonKeys = generateKeys('separateReason', 10);

// filters each seperateReason and returns the number or people who responded
function calcNumResponses(key, array) {
  var filteredArray = array.filter(function(arrayEntry) {
    return arrayEntry[key] !== '';
  });
  return filteredArray.length;
}

// takes the array of keys and the array of objects and maps the number of
// responses to the array of keys
function getReasonCounts(keysArray, reasonsArray) {
  return keysArray.map(function(key) {
    return calcNumResponses(key, reasonsArray);
  })
};

// console.log(getReasonCounts(reasonKeys, reasonsMale));
// console.log(getReasonCounts(reasonKeys, reasonsFemale));








});

</script>
